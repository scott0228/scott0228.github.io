---
layout: post
title: "Debugging Deadlocks - Print All Stack Traces"
date: 2008-12-16T21:58:00+08:00
---

<div class='post'>
http://www.symphonious.net/2008/11/24/debugging-deadlocks-print-all-stack-traces/
如何處理 Deadlock ，雖然最近沒在寫 thread 的程式，不過留著記錄，說不定哪天會用到。
<pre class="code"><span class="java_keyword">private</span><span class="java_plain"> </span><span class="java_keyword">static</span><span class="java_plain"> </span><span class="java_type">void</span><span class="java_plain"> printAllStackTraces</span><span class="java_separator">()</span><span class="java_plain"> </span><span class="java_separator">{</span>
<span class="java_plain">    </span><span class="java_type">Map</span><span class="java_plain"> liveThreads </span><span class="java_operator">=</span><span class="java_plain"> </span><span class="java_type">Thread</span><span class="java_separator">.</span><span class="java_plain">getAllStackTraces</span><span class="java_separator">();</span>
<span class="java_plain">    </span><span class="java_keyword">for</span><span class="java_plain"> </span><span class="java_separator">(</span><span class="java_type">Iterator</span><span class="java_plain"> i </span><span class="java_operator">=</span><span class="java_plain"> liveThreads</span><span class="java_separator">.</span><span class="java_plain">keySet</span><span class="java_separator">().</span><span class="java_plain">iterator</span><span class="java_separator">();</span><span class="java_plain"> i</span><span class="java_separator">.</span><span class="java_plain">hasNext</span><span class="java_separator">();</span><span class="java_plain"> </span><span class="java_separator">)</span><span class="java_plain"> </span><span class="java_separator">{</span>
<span class="java_plain">      </span><span class="java_type">Thread</span><span class="java_plain"> key </span><span class="java_operator">=</span><span class="java_plain"> </span><span class="java_separator">(</span><span class="java_type">Thread</span><span class="java_separator">)</span><span class="java_plain">i</span><span class="java_separator">.</span><span class="java_plain">next</span><span class="java_separator">();</span>
<span class="java_plain">      </span><span class="java_type">System</span><span class="java_separator">.</span><span class="java_plain">err</span><span class="java_separator">.</span><span class="java_plain">println</span><span class="java_separator">(</span><span class="java_literal">"Thread "</span><span class="java_plain"> </span><span class="java_operator">+</span><span class="java_plain"> key</span><span class="java_separator">.</span><span class="java_plain">getName</span><span class="java_separator">());</span>
<span class="java_plain">        </span><span class="java_type">StackTraceElement</span><span class="java_separator">[]</span><span class="java_plain"> trace </span><span class="java_operator">=</span><span class="java_plain"> </span><span class="java_separator">(</span><span class="java_type">StackTraceElement</span><span class="java_separator">[])</span><span class="java_plain">liveThreads</span><span class="java_separator">.</span><span class="java_plain">get</span><span class="java_separator">(</span><span class="java_plain">key</span><span class="java_separator">);</span>
<span class="java_plain">        </span><span class="java_keyword">for</span><span class="java_plain"> </span><span class="java_separator">(</span><span class="java_type">int</span><span class="java_plain"> j </span><span class="java_operator">=</span><span class="java_plain"> </span><span class="java_literal">0</span><span class="java_separator">;</span><span class="java_plain"> j </span><span class="java_operator"><</span><span class="java_plain"> trace</span><span class="java_separator">.</span><span class="java_plain">length</span><span class="java_separator">;</span><span class="java_plain"> j</span><span class="java_operator">++</span><span class="java_separator">)</span><span class="java_plain"> </span><span class="java_separator">{</span>
<span class="java_plain">            </span><span class="java_type">System</span><span class="java_separator">.</span><span class="java_plain">err</span><span class="java_separator">.</span><span class="java_plain">println</span><span class="java_separator">(</span><span class="java_literal">"\tat "</span><span class="java_plain"> </span><span class="java_operator">+</span><span class="java_plain"> trace</span><span class="java_separator">[</span><span class="java_plain">j</span><span class="java_separator">]);</span>
<span class="java_plain">        </span><span class="java_separator">}</span>
<span class="java_plain">    </span><span class="java_separator">}</span>
<span class="java_separator">}</span>

其內容是寫說用上面這 method 去印出 thread 中的相關資訊，以便發現是哪個 thread 造成的 lock。
</pre></div>
